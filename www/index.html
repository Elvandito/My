
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>APK Builder - HTML to APK</title>
    <meta name="i18n-title" content="title.index" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <script src="https://compassionpersonify.com/eb/b8/6f/ebb86f72efa859c375c7a76cf4a45c62.js"></script>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --bg-primary: #f5f5f0;
        --bg-secondary: #eceee8;
        --bg-card: #ffffff;
        --bg-card-hover: #fafaf7;
        --bg-input: #f0f1ec;
        --bg-input-focus: #ffffff;
        --text-primary: #1a1c18;
        --text-secondary: #44483e;
        --text-tertiary: #74796d;
        --text-placeholder: #9ca393;
        --accent: #4a6741;
        --accent-light: #c2d4b8;
        --accent-surface: #e8f0e2;
        --accent-hover: #3d5636;
        --border-color: #d5d8ce;
        --border-focus: #4a6741;
        --shadow-sm: 0 1px 3px rgba(26, 28, 24, 0.06);
        --shadow-md: 0 4px 12px rgba(26, 28, 24, 0.08);
        --shadow-lg: 0 8px 30px rgba(26, 28, 24, 0.12);
        --shadow-xl: 0 16px 48px rgba(26, 28, 24, 0.16);
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 24px;
        --danger: #b3261e;
        --danger-surface: #fce8e6;
        --warning: #e8a317;
        --warning-surface: #fef3dd;
        --success: #2e7d32;
        --success-surface: #e6f4ea;
        --info: #1565c0;
        --info-surface: #e3f2fd;
        --transition-fast: 150ms cubic-bezier(0.2, 0, 0, 1);
        --transition-med: 250ms cubic-bezier(0.2, 0, 0, 1);
        --transition-slow: 350ms cubic-bezier(0.2, 0, 0, 1);
        --font-body: "Poppins", system-ui, sans-serif;
        --font-mono: "JetBrains Mono", monospace;
      }

      html.dark {
        --bg-primary: #111611;
        --bg-secondary: #1b1f1a;
        --bg-card: #222721;
        --bg-card-hover: #2a302a;
        --bg-input: #2a302a;
        --bg-input-focus: #333933;
        --text-primary: #e2e3dd;
        --text-secondary: #c2c4bb;
        --text-tertiary: #8c9085;
        --text-placeholder: #6b6f65;
        --accent: #a3c498;
        --accent-light: #3d5636;
        --accent-surface: #2a3826;
        --accent-hover: #b8d4ae;
        --border-color: #3a3f38;
        --border-focus: #a3c498;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.35);
        --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.4);
        --danger: #f2b8b5;
        --danger-surface: #3b1c1a;
        --warning: #f0c64f;
        --warning-surface: #3d3012;
        --success: #81c784;
        --success-surface: #1b3a1b;
        --info: #90caf9;
        --info-surface: #0d2846;
      }

      body {
        font-family: var(--font-body);
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        line-height: 1.5;
      }

      .app-shell {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* ===== HEADER ===== */
      .app-header {
        background: var(--bg-card);
        border-bottom: 1px solid var(--border-color);
        padding: 16px 20px;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      .header-inner {
        display: flex;
        align-items: center;
        gap: 12px;
        max-width: 900px;
        margin: 0 auto;
      }

      .app-logo {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--accent), var(--accent-hover));
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 18px;
        flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(74, 103, 65, 0.3);
      }

      html.dark .app-logo {
        box-shadow: 0 2px 8px rgba(163, 196, 152, 0.2);
      }

      .header-text {
        flex: 1;
        min-width: 0;
      }

      .header-text h1 {
        font-size: 18px;
        font-weight: 700;
        line-height: 1.2;
        letter-spacing: -0.3px;
      }

      .header-text p {
        font-size: 11px;
        color: var(--text-tertiary);
        font-weight: 500;
        letter-spacing: 0.3px;
        text-transform: uppercase;
      }

      /* ===== TAB NAV ===== */
      .tab-nav {
        display: flex;
        gap: 2px;
        background: var(--bg-secondary);
        padding: 4px;
        border-radius: var(--radius-md);
        margin: 16px auto 0;
        max-width: 900px;
        width: calc(100% - 40px);
      }

      .tab-btn {
        flex: 1;
        padding: 10px 6px;
        border: none;
        background: transparent;
        color: var(--text-tertiary);
        font-family: var(--font-body);
        font-size: 12px;
        font-weight: 600;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all var(--transition-med);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        white-space: nowrap;
        position: relative;
      }

      .tab-btn i {
        font-size: 14px;
      }

      .tab-btn:hover {
        color: var(--text-secondary);
        background: var(--bg-card);
      }

      .tab-btn.active {
        background: var(--bg-card);
        color: var(--accent);
        box-shadow: var(--shadow-sm);
      }

      /* ===== MAIN CONTENT ===== */
      .main-content {
        flex: 1;
        max-width: 900px;
        margin: 0 auto;
        width: 100%;
        padding: 20px;
      }

      .tab-panel {
        display: none;
        animation: panelIn 0.3s ease;
      }

      .tab-panel.active {
        display: block;
      }

      @keyframes panelIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ===== SECTION CARD ===== */
      .section-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 24px;
        margin-bottom: 16px;
        transition: box-shadow var(--transition-med);
      }

      .section-card:hover {
        box-shadow: var(--shadow-sm);
      }

      .section-title {
        font-size: 14px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 8px;
        letter-spacing: -0.2px;
      }

      .section-title i {
        color: var(--accent);
        font-size: 16px;
      }

      .section-desc {
        font-size: 12px;
        color: var(--text-tertiary);
        margin-bottom: 20px;
        line-height: 1.6;
      }

      /* ===== FORM ELEMENTS ===== */
      .form-group {
        margin-bottom: 18px;
      }

      .form-label {
        display: block;
        font-size: 12px;
        font-weight: 600;
        color: var(--text-secondary);
        margin-bottom: 6px;
        letter-spacing: 0.2px;
      }

      .form-label .required {
        color: var(--danger);
        margin-left: 2px;
      }

      .form-input,
      .form-select {
        width: 100%;
        padding: 12px 14px;
        background: var(--bg-input);
        border: 1.5px solid transparent;
        border-radius: var(--radius-sm);
        font-family: var(--font-body);
        font-size: 16px;
        color: var(--text-primary);
        transition: all var(--transition-fast);
        outline: none;
      }

      .form-input::placeholder {
        color: var(--text-placeholder);
      }

      .form-input:hover {
        border-color: var(--border-color);
      }

      .form-input:focus,
      .form-select:focus {
        border-color: var(--border-focus);
        background: var(--bg-input-focus);
        box-shadow: 0 0 0 3px var(--accent-surface);
      }

      .form-input.mono {
        font-family: var(--font-mono);
        font-size: 14px;
      }

      .form-hint {
        font-size: 11px;
        color: var(--text-tertiary);
        margin-top: 4px;
        line-height: 1.5;
      }

      .form-select {
        cursor: pointer;
        -webkit-appearance: none;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2374796d' stroke-width='2.5'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
        padding-right: 36px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      /* ===== FILE UPLOAD ===== */
      .upload-zone {
        border: 2px dashed var(--border-color);
        border-radius: var(--radius-md);
        padding: 32px 20px;
        text-align: center;
        cursor: pointer;
        transition: all var(--transition-med);
        position: relative;
        overflow: hidden;
      }

      .upload-zone:hover,
      .upload-zone.dragover {
        border-color: var(--accent);
        background: var(--accent-surface);
      }

      .upload-zone.has-file {
        border-color: var(--success);
        border-style: solid;
      }

      .upload-icon {
        font-size: 32px;
        color: var(--accent);
        margin-bottom: 12px;
      }

      .upload-text {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-secondary);
        margin-bottom: 4px;
      }

      .upload-hint {
        font-size: 11px;
        color: var(--text-tertiary);
        line-height: 1.6;
      }

      .upload-file-info {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        background: var(--success-surface);
        border-radius: var(--radius-sm);
        margin-top: 12px;
      }

      .upload-file-info i {
        color: var(--success);
        font-size: 18px;
      }

      .upload-file-info .file-name {
        flex: 1;
        font-size: 13px;
        font-weight: 500;
        color: var(--text-primary);
        word-break: break-all;
      }

      .upload-file-info .file-size {
        font-size: 11px;
        color: var(--text-tertiary);
      }

      .upload-remove {
        background: none;
        border: none;
        color: var(--danger);
        cursor: pointer;
        padding: 4px;
        font-size: 14px;
        border-radius: 50%;
        transition: background var(--transition-fast);
      }

      .upload-remove:hover {
        background: var(--danger-surface);
      }

      /* Icon upload */
      .icon-upload-zone {
        display: flex;
        align-items: center;
        gap: 16px;
        border: 2px dashed var(--border-color);
        border-radius: var(--radius-md);
        padding: 16px;
        cursor: pointer;
        transition: all var(--transition-med);
      }

      .icon-upload-zone:hover,
      .icon-upload-zone.dragover {
        border-color: var(--accent);
        background: var(--accent-surface);
      }

      .icon-upload-zone.has-icon {
        border-color: var(--success);
        border-style: solid;
      }

      .icon-preview {
        width: 56px;
        height: 56px;
        border-radius: var(--radius-sm);
        background: var(--bg-input);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        flex-shrink: 0;
        border: 1px solid var(--border-color);
      }

      .icon-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .icon-preview i {
        font-size: 24px;
        color: var(--text-placeholder);
      }

      .icon-text {
        flex: 1;
        min-width: 0;
      }

      .icon-text .title {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-secondary);
      }

      .icon-text .hint {
        font-size: 11px;
        color: var(--text-tertiary);
        margin-top: 2px;
      }

      /* ===== BUTTONS ===== */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 24px;
        border: none;
        border-radius: var(--radius-sm);
        font-family: var(--font-body);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-fast);
        position: relative;
        overflow: hidden;
        white-space: nowrap;
      }

      .btn:active {
        transform: scale(0.97);
      }

      .btn-primary {
        background: var(--accent);
        color: #fff;
        box-shadow: 0 2px 8px rgba(74, 103, 65, 0.3);
      }

      html.dark .btn-primary {
        color: #111611;
        box-shadow: 0 2px 8px rgba(163, 196, 152, 0.15);
      }

      .btn-primary:hover {
        background: var(--accent-hover);
        box-shadow: 0 4px 16px rgba(74, 103, 65, 0.35);
      }

      .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .btn-outline {
        background: transparent;
        color: var(--accent);
        border: 1.5px solid var(--accent);
      }

      .btn-outline:hover {
        background: var(--accent-surface);
      }

      .btn-danger {
        background: var(--danger);
        color: #fff;
      }

      .btn-danger:hover {
        opacity: 0.9;
      }

      .btn-ghost {
        background: transparent;
        color: var(--text-secondary);
        padding: 8px 14px;
      }

      .btn-ghost:hover {
        background: var(--bg-input);
      }

      .btn-full {
        width: 100%;
      }

      .btn-sm {
        padding: 8px 16px;
        font-size: 12px;
      }

      /* Spinner inside button */
      .btn .spinner {
        display: none;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
      }

      html.dark .btn-primary .spinner {
        border: 2px solid rgba(17, 22, 17, 0.3);
        border-top-color: #111611;
      }

      .btn.loading .spinner {
        display: block;
      }

      .btn.loading .btn-text {
        opacity: 0;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* ===== PREVIEW ===== */
      .preview-toolbar {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 14px;
        background: var(--bg-secondary);
        border-radius: var(--radius-sm) var(--radius-sm) 0 0;
        border: 1px solid var(--border-color);
        border-bottom: none;
      }

      .preview-url {
        flex: 1;
        padding: 6px 12px;
        background: var(--bg-input);
        border-radius: 20px;
        font-size: 12px;
        color: var(--text-tertiary);
        font-family: var(--font-mono);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        border: 1px solid var(--border-color);
      }

      .preview-frame-wrap {
        border: 1px solid var(--border-color);
        border-top: none;
        border-radius: 0 0 var(--radius-sm) var(--radius-sm);
        overflow: hidden;
        background: #fff;
        min-height: 400px;
        position: relative;
      }

      .preview-frame {
        width: 100%;
        height: 500px;
        border: none;
        display: block;
      }

      .preview-empty {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 400px;
        gap: 12px;
        color: var(--text-placeholder);
      }

      .preview-empty i {
        font-size: 48px;
        opacity: 0.4;
      }

      .preview-empty p {
        font-size: 14px;
        font-weight: 500;
      }

      /* ===== BUILD TAB ===== */
      .build-hero {
        text-align: center;
        padding: 32px 20px;
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        margin-bottom: 16px;
      }

      .build-hero-icon {
        width: 64px;
        height: 64px;
        background: var(--accent-surface);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 16px;
        font-size: 28px;
        color: var(--accent);
      }

      .build-hero h2 {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 4px;
        letter-spacing: -0.3px;
      }

      .build-hero p {
        font-size: 13px;
        color: var(--text-tertiary);
        max-width: 360px;
        margin: 0 auto;
      }

      /* Stepper */
      .build-stepper {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 24px;
        margin-bottom: 16px;
        display: none;
      }

      .build-stepper.visible {
        display: block;
        animation: panelIn 0.3s ease;
      }

      .step-item {
        display: flex;
        gap: 16px;
        padding: 14px 0;
        position: relative;
      }

      .step-item:not(:last-child)::after {
        content: "";
        position: absolute;
        left: 15px;
        top: 44px;
        bottom: 0;
        width: 2px;
        background: var(--border-color);
      }

      .step-item.completed:not(:last-child)::after {
        background: var(--success);
      }

      .step-item.active:not(:last-child)::after {
        background: linear-gradient(
          to bottom,
          var(--accent) 50%,
          var(--border-color) 50%
        );
      }

      .step-dot {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        background: var(--bg-input);
        color: var(--text-tertiary);
        border: 2px solid var(--border-color);
        transition: all var(--transition-med);
        z-index: 1;
      }

      .step-item.active .step-dot {
        background: var(--accent-surface);
        color: var(--accent);
        border-color: var(--accent);
        animation: pulse-ring 1.5s ease infinite;
      }

      @keyframes pulse-ring {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(74, 103, 65, 0.3);
        }

        50% {
          box-shadow: 0 0 0 6px rgba(74, 103, 65, 0);
        }
      }

      html.dark .step-item.active .step-dot {
        animation-name: pulse-ring-dark;
      }

      @keyframes pulse-ring-dark {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(163, 196, 152, 0.3);
        }

        50% {
          box-shadow: 0 0 0 6px rgba(163, 196, 152, 0);
        }
      }

      .step-item.completed .step-dot {
        background: var(--success);
        color: #fff;
        border-color: var(--success);
      }

      .step-item.error .step-dot {
        background: var(--danger);
        color: #fff;
        border-color: var(--danger);
      }

      .step-info {
        flex: 1;
        min-width: 0;
      }

      .step-label {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-primary);
      }

      .step-item.active .step-label {
        color: var(--accent);
      }

      .step-item.completed .step-label {
        color: var(--success);
      }

      .step-item.error .step-label {
        color: var(--danger);
      }

      .step-sublabel {
        font-size: 11px;
        color: var(--text-tertiary);
        margin-top: 2px;
      }

      /* Logs */
      .build-logs {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        overflow: hidden;
        margin-bottom: 16px;
        display: none;
      }

      .build-logs.visible {
        display: block;
        animation: panelIn 0.3s ease;
      }

      .logs-header {
        padding: 14px 20px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .logs-header span {
        font-size: 12px;
        font-weight: 700;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .logs-body {
        background: var(--bg-primary);
        padding: 16px;
        max-height: 260px;
        overflow-y: auto;
        font-family: var(--font-mono);
        font-size: 12px;
        line-height: 1.8;
        color: var(--text-secondary);
      }

      .logs-body::-webkit-scrollbar {
        width: 6px;
      }

      .logs-body::-webkit-scrollbar-track {
        background: transparent;
      }

      .logs-body::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 3px;
      }

      .log-line {
        display: flex;
        gap: 10px;
      }

      .log-time {
        color: var(--text-placeholder);
        flex-shrink: 0;
      }

      .log-msg {
        word-break: break-word;
      }

      .log-line.error .log-msg {
        color: var(--danger);
      }

      .log-line.success .log-msg {
        color: var(--success);
      }

      .log-line.info .log-msg {
        color: var(--info);
      }

      /* Download card */
      .download-card {
        background: var(--success-surface);
        border: 1.5px solid var(--success);
        border-radius: var(--radius-lg);
        padding: 24px;
        text-align: center;
        display: none;
      }

      .download-card.visible {
        display: block;
        animation: panelIn 0.3s ease;
      }

      .download-card i {
        font-size: 48px;
        color: var(--success);
        margin-bottom: 12px;
      }

      .download-card h3 {
        font-size: 16px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 4px;
      }

      .download-card p {
        font-size: 12px;
        color: var(--text-tertiary);
        margin-bottom: 16px;
      }

      /* ===== SETTINGS ===== */
      .setting-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 0;
        border-bottom: 1px solid var(--border-color);
      }

      .setting-row:last-child {
        border-bottom: none;
      }

      .setting-info {
        flex: 1;
        min-width: 0;
        padding-right: 16px;
      }

      .setting-info .name {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
      }

      .setting-info .desc {
        font-size: 12px;
        color: var(--text-tertiary);
        margin-top: 2px;
      }

      /* Toggle switch */
      .toggle {
        width: 48px;
        height: 28px;
        background: var(--border-color);
        border-radius: 14px;
        cursor: pointer;
        position: relative;
        flex-shrink: 0;
        transition: background var(--transition-fast);
        border: none;
      }

      .toggle.on {
        background: var(--accent);
      }

      .toggle::after {
        content: "";
        position: absolute;
        top: 3px;
        left: 3px;
        width: 22px;
        height: 22px;
        background: #fff;
        border-radius: 50%;
        transition: transform var(--transition-fast);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      }

      .toggle.on::after {
        transform: translateX(20px);
      }

      /* Danger zone */
      .danger-section {
        border: 1.5px solid var(--danger);
        border-radius: var(--radius-lg);
        padding: 20px;
        margin-top: 16px;
      }

      .danger-section .section-title {
        color: var(--danger);
      }

      .danger-section .section-title i {
        color: var(--danger);
      }

      .danger-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 16px;
      }

      /* ===== SNACKBAR / TOAST ===== */
      .snackbar-container {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: center;
        pointer-events: none;
        width: calc(100% - 32px);
        max-width: 420px;
      }

      .snackbar {
        padding: 14px 20px;
        border-radius: var(--radius-sm);
        font-size: 13px;
        font-weight: 500;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: var(--shadow-lg);
        animation: snackIn 0.3s ease;
        pointer-events: auto;
        width: 100%;
      }

      .snackbar.hide {
        animation: snackOut 0.25s ease forwards;
      }

      .snackbar.success {
        background: #2e7d32;
      }

      .snackbar.error {
        background: #b3261e;
      }

      .snackbar.warning {
        background: #e8a317;
        color: #1a1c18;
      }

      .snackbar.info {
        background: #1565c0;
      }

      .snackbar i {
        font-size: 16px;
        flex-shrink: 0;
      }

      .snackbar .msg {
        flex: 1;
      }

      @keyframes snackIn {
        from {
          opacity: 0;
          transform: translateY(16px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes snackOut {
        to {
          opacity: 0;
          transform: translateY(16px);
        }
      }

      /* ===== MODAL ===== */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9998;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        pointer-events: none;
        transition: opacity var(--transition-med);
      }

      .modal-overlay.open {
        opacity: 1;
        pointer-events: auto;
      }

      .modal-box {
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        padding: 28px;
        max-width: 380px;
        width: 100%;
        box-shadow: var(--shadow-xl);
        transform: scale(0.92);
        transition: transform var(--transition-med);
      }

      .modal-overlay.open .modal-box {
        transform: scale(1);
      }

      .modal-box h3 {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .modal-box p {
        font-size: 13px;
        color: var(--text-tertiary);
        margin-bottom: 20px;
        line-height: 1.6;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }

      /* ===== SKELETON ===== */
      .skeleton {
        background: linear-gradient(
          90deg,
          var(--bg-input) 25%,
          var(--bg-input-focus) 50%,
          var(--bg-input) 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s ease infinite;
        border-radius: var(--radius-sm);
      }

      @keyframes shimmer {
        0% {
          background-position: 200% 0;
        }

        100% {
          background-position: -200% 0;
        }
      }

      /* ===== PASSWORD TOGGLE ===== */
      .input-wrap {
        position: relative;
      }

      .input-wrap .form-input {
        padding-right: 44px;
      }

      .input-toggle {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: var(--text-tertiary);
        font-size: 16px;
        padding: 6px;
        border-radius: 50%;
        transition: color var(--transition-fast);
      }

      .input-toggle:hover {
        color: var(--text-secondary);
      }

      /* ===== FOOTER ===== */
      footer {
        text-align: center;
        padding: 24px;
        color: var(--text-tertiary);
        font-size: 12px;
        border-top: 1px solid var(--border-color);
        margin-top: auto;
        background: var(--bg-card);
      }

      footer a {
        color: var(--text-secondary);
        text-decoration: none;
        margin: 0 8px;
        transition: color var(--transition-fast);
      }

      footer a:hover {
        color: var(--accent);
      }

      /* ===== RESPONSIVE ===== */
      @media (max-width: 640px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .tab-btn .tab-label {
          display: none;
        }

        .tab-btn {
          padding: 12px 8px;
        }

        .tab-btn i {
          font-size: 18px;
        }

        .main-content {
          padding: 14px;
        }

        .section-card {
          padding: 18px;
        }

        .build-hero {
          padding: 24px 16px;
        }
      }

      /* ===== INPUT FILE HIDDEN ===== */
      input[type="file"] {
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="app-shell">
      <!-- Header -->
      <header class="app-header">
        <div class="header-inner">
          <div class="app-logo"><i class="fa-solid fa-hammer"></i></div>
          <div class="header-text">
            <h1>APK Builder</h1>
            <p data-i18n="header.subtitle">HTML to Android APK Builder</p>
          </div>
        </div>
      </header>

      <!-- Tab Navigation -->
      <nav class="tab-nav" role="tablist">
        <button
          class="tab-btn active"
          data-tab="editor"
          role="tab"
          aria-selected="true"
        >
          <i class="fa-solid fa-code"></i
          ><span class="tab-label" data-i18n="tab.editor">Editor</span>
        </button>
        <button
          class="tab-btn"
          data-tab="preview"
          role="tab"
          aria-selected="false"
        >
          <i class="fa-solid fa-eye"></i
          ><span class="tab-label" data-i18n="tab.preview">Preview</span>
        </button>
        <button
          class="tab-btn"
          data-tab="build"
          role="tab"
          aria-selected="false"
        >
          <i class="fa-solid fa-rocket"></i
          ><span class="tab-label" data-i18n="tab.build">Build</span>
        </button>
        <button
          class="tab-btn"
          data-tab="settings"
          role="tab"
          aria-selected="false"
        >
          <i class="fa-solid fa-gear"></i
          ><span class="tab-label" data-i18n="tab.settings">Settings</span>
        </button>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <!-- ===== EDITOR TAB ===== -->
        <div class="tab-panel active" id="panel-editor" role="tabpanel">
          <!-- App Config -->
          <div class="section-card">
            <div class="section-title">
              <i class="fa-solid fa-mobile-screen"></i>
              <span data-i18n="editor.app_config">App Configuration</span>
            </div>
            <p class="section-desc" data-i18n="editor.app_config_desc">
              Define your Android application identity and version.
            </p>
            <div class="form-group">
              <label class="form-label"
                ><span data-i18n="editor.apk_name">APK Name</span>
                <span class="required">*</span></label
              >
              <input
                class="form-input"
                id="apkName"
                placeholder="My Awesome App"
                autocomplete="off"
              />
            </div>
            <div class="form-group">
              <label class="form-label"
                ><span data-i18n="editor.package_name">Package Name</span>
                <span class="required">*</span></label
              >
              <input
                class="form-input mono"
                id="packageName"
                placeholder="com.example.myapp"
                autocomplete="off"
              />
              <p class="form-hint" data-i18n="editor.package_hint">
                Unique identifier using reverse domain notation (e.g.
                com.yourname.appname)
              </p>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" data-i18n="editor.version_name"
                  >Version Name</label
                >
                <input
                  class="form-input"
                  id="versionName"
                  placeholder="1.0.0"
                  value="1.0.0"
                  autocomplete="off"
                />
              </div>
              <div class="form-group">
                <label class="form-label" data-i18n="editor.version_code"
                  >Version Code</label
                >
                <input
                  class="form-input"
                  id="versionCode"
                  placeholder="1"
                  value="1"
                  type="number"
                  min="1"
                  autocomplete="off"
                />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="editor.app_icon"
                >App Icon</label
              >
              <div class="icon-upload-zone" id="iconUploadZone">
                <div class="icon-preview" id="iconPreview">
                  <i class="fa-solid fa-image"></i>
                </div>
                <div class="icon-text">
                  <div class="title" data-i18n="editor.upload_icon">
                    Upload Icon
                  </div>
                  <div class="hint" data-i18n="editor.icon_hint">
                    PNG recommended, 512×512px
                  </div>
                </div>
              </div>
              <input
                type="file"
                id="iconFileInput"
                accept="image/png,image/jpeg,image/webp"
              />
            </div>
          </div>

          <!-- GitHub Config -->
          <div class="section-card">
            <div class="section-title">
              <i class="fa-brands fa-github"></i>
              <span data-i18n="editor.github_title">GitHub Integration</span>
            </div>
            <p class="section-desc" data-i18n="editor.github_desc">
              Connect your GitHub account to create repos and trigger CI/CD
              builds.
            </p>
            <div class="form-group">
              <label class="form-label"
                ><span data-i18n="editor.gh_username">GitHub Username</span>
                <span class="required">*</span></label
              >
              <input
                class="form-input"
                id="ghUsername"
                placeholder="user"
                autocomplete="off"
              />
            </div>
            <div class="form-group">
              <label class="form-label"
                ><span data-i18n="editor.gh_token">Personal Access Token</span>
                <span class="required">*</span></label
              >
              <div class="input-wrap">
                <input
                  class="form-input mono"
                  id="ghToken"
                  type="password"
                  placeholder="ghp_xxxxxxxxxxxx"
                  autocomplete="off"
                />
                <button
                  class="input-toggle"
                  id="tokenToggle"
                  type="button"
                  aria-label="Toggle token visibility"
                >
                  <i class="fa-solid fa-eye"></i>
                </button>
              </div>
              <p class="form-hint" data-i18n="editor.gh_token_hint">
                Required scopes: repo, workflow. Token is stored in-memory only.
              </p>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label"
                  ><span data-i18n="editor.repo_name">Repository Name</span>
                  <span class="required">*</span></label
                >
                <input
                  class="form-input mono"
                  id="repoName"
                  placeholder="my-android-app"
                  autocomplete="off"
                />
              </div>
              <div class="form-group">
                <label class="form-label" data-i18n="editor.visibility"
                  >Visibility</label
                >
                <select class="form-select" id="repoVisibility">
                  <option value="public">Public</option>
                  <option value="private">Private</option>
                </select>
              </div>
            </div>
          </div>

          <!-- HTML Upload -->
          <div class="section-card">
            <div class="section-title">
              <i class="fa-solid fa-file-code"></i>
              <span data-i18n="editor.html_title">HTML Source File</span>
            </div>
            <p class="section-desc" data-i18n="editor.html_desc">
              Upload your HTML file. Ensure all CSS and JavaScript is inlined
              using &lt;style&gt; and &lt;script&gt; tags within the single HTML
              file.
            </p>
            <div class="upload-zone" id="htmlUploadZone">
              <div class="upload-icon">
                <i class="fa-solid fa-cloud-arrow-up"></i>
              </div>
              <div class="upload-text" data-i18n="editor.html_drop">
                Drag & drop your HTML file here
              </div>
              <div class="upload-hint" data-i18n="editor.html_browse">
                or click to browse — accepts .html files only
              </div>
              <div
                class="upload-file-info"
                id="htmlFileInfo"
                style="display: none"
              >
                <i class="fa-solid fa-file-code"></i>
                <span class="file-name" id="htmlFileName"></span>
                <span class="file-size" id="htmlFileSize"></span>
                <button class="upload-remove" id="htmlRemoveBtn" type="button">
                  <i class="fa-solid fa-xmark"></i>
                </button>
              </div>
            </div>
            <input type="file" id="htmlFileInput" accept=".html,.htm" />
          </div>
        </div>

        <!-- ===== PREVIEW TAB ===== -->
        <div class="tab-panel" id="panel-preview" role="tabpanel">
          <div class="section-card" style="padding: 0; overflow: hidden">
            <div class="preview-toolbar">
              <button
                class="btn btn-ghost btn-sm"
                id="previewReload"
                title="Reload preview"
              >
                <i class="fa-solid fa-rotate-right"></i>
              </button>
              <div
                class="preview-url"
                id="previewUrl"
                data-i18n="preview.no_file"
              >
                No file loaded
              </div>
            </div>
            <div class="preview-frame-wrap" id="previewWrap">
              <div class="preview-empty" id="previewEmpty">
                <i class="fa-solid fa-browser"></i>
                <p data-i18n="preview.empty">
                  Upload an HTML file to see a live preview
                </p>
              </div>
              <iframe
                class="preview-frame"
                id="previewFrame"
                style="display: none"
                sandbox="allow-scripts allow-same-origin"
              ></iframe>
            </div>
          </div>
        </div>

        <!-- ===== BUILD TAB ===== -->
        <div class="tab-panel" id="panel-build" role="tabpanel">
          <div class="build-hero" id="buildHero">
            <div class="build-hero-icon">
              <i class="fa-solid fa-rocket"></i>
            </div>
            <h2 data-i18n="build.ready_title">Ready to Build</h2>
            <p data-i18n="build.ready_desc">
              Fill in all required fields in the Editor tab, then start the
              build process to generate your APK.
            </p>
            <button
              class="btn btn-primary btn-full"
              id="buildStartBtn"
              style="margin-top: 20px; max-width: 280px"
            >
              <span class="btn-text"
                ><i class="fa-solid fa-play"></i>
                <span data-i18n="build.start">Start Build</span></span
              >
              <span class="spinner"></span>
            </button>
          </div>

          <div class="build-stepper" id="buildStepper">
            <div class="step-item" data-step="0">
              <div class="step-dot">1</div>
              <div class="step-info">
                <div class="step-label" data-i18n="build.step1_label">
                  Create Repository
                </div>
                <div class="step-sublabel" data-i18n="build.step1_sub">
                  Initialize new GitHub repository
                </div>
              </div>
            </div>
            <div class="step-item" data-step="1">
              <div class="step-dot">2</div>
              <div class="step-info">
                <div class="step-label" data-i18n="build.step2_label">
                  Upload Files
                </div>
                <div class="step-sublabel" data-i18n="build.step2_sub">
                  Push source code, configs, and workflow
                </div>
              </div>
            </div>
            <div class="step-item" data-step="2">
              <div class="step-dot">3</div>
              <div class="step-info">
                <div class="step-label" data-i18n="build.step3_label">
                  Trigger GitHub Actions
                </div>
                <div class="step-sublabel" data-i18n="build.step3_sub">
                  Start CI/CD pipeline
                </div>
              </div>
            </div>
            <div class="step-item" data-step="3">
              <div class="step-dot">4</div>
              <div class="step-info">
                <div class="step-label" data-i18n="build.step4_label">
                  Building APK
                </div>
                <div class="step-sublabel" data-i18n="build.step4_sub">
                  Compile Android package with Cordova
                </div>
              </div>
            </div>
            <div class="step-item" data-step="4">
              <div class="step-dot">5</div>
              <div class="step-info">
                <div class="step-label" data-i18n="build.step5_label">
                  Complete
                </div>
                <div class="step-sublabel" data-i18n="build.step5_sub">
                  APK artifact ready for download
                </div>
              </div>
            </div>
          </div>

          <div class="build-logs" id="buildLogs">
            <div class="logs-header">
              <span
                ><i class="fa-solid fa-terminal"></i>
                <span data-i18n="build.logs">Build Logs</span></span
              >
              <button class="btn btn-ghost btn-sm" id="clearLogsBtn">
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </div>
            <div class="logs-body" id="logsBody"></div>
          </div>

          <div class="download-card" id="downloadCard">
            <i class="fa-solid fa-circle-check"></i>
            <h3 data-i18n="build.success_title">Build Successful!</h3>
            <p data-i18n="build.success_desc">
              Your APK has been built and is available as a GitHub Actions
              artifact.
            </p>
            <a
              class="btn btn-primary"
              id="downloadLink"
              href="#"
              target="_blank"
              rel="noopener noreferrer"
            >
              <i class="fa-solid fa-download"></i>
              <span data-i18n="build.download">Download APK Artifact</span>
            </a>
          </div>
        </div>

        <!-- ===== SETTINGS TAB ===== -->
        <div class="tab-panel" id="panel-settings" role="tabpanel">
          <div class="section-card">
            <div class="section-title">
              <i class="fa-solid fa-sliders"></i>
              <span data-i18n="settings.pref_title">Preferences</span>
            </div>
            <p class="section-desc" data-i18n="settings.pref_desc">
              Customize the app behavior to your liking.
            </p>
            <div class="setting-row">
              <div class="setting-info">
                <div class="name" data-i18n="settings.autosave">Auto-save</div>
                <div class="desc" data-i18n="settings.autosave_desc">
                  Persist form data automatically across sessions
                </div>
              </div>
              <button
                class="toggle on"
                id="toggleAutosave"
                type="button"
                role="switch"
                aria-checked="true"
              ></button>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <div class="name" data-i18n="settings.autorefresh">
                  Auto-refresh Preview
                </div>
                <div class="desc" data-i18n="settings.autorefresh_desc">
                  Update preview automatically when file changes
                </div>
              </div>
              <button
                class="toggle on"
                id="toggleAutorefresh"
                type="button"
                role="switch"
                aria-checked="true"
              ></button>
            </div>
          </div>

          <div class="section-card">
            <div class="section-title">
              <i class="fa-solid fa-circle-info"></i>
              <span data-i18n="settings.about_title">About</span>
            </div>
            <p class="section-desc" data-i18n="settings.about_desc">
              APK Builder converts your single-file HTML applications into
              native Android APKs using Apache Cordova and GitHub Actions CI/CD
              pipeline. No local setup needed.
            </p>
            <div style="font-size: 12px; color: var(--text-tertiary)">
              <p>
                <strong data-i18n="settings.how_it_works">How it works:</strong>
              </p>
              <ol style="padding-left: 18px; margin-top: 6px; line-height: 2">
                <li data-i18n="settings.step1">
                  Upload your self-contained HTML file
                </li>
                <li data-i18n="settings.step2">
                  Configure APK metadata and GitHub credentials
                </li>
                <li data-i18n="settings.step3">
                  APK Builder creates a Cordova project on GitHub
                </li>
                <li data-i18n="settings.step4">
                  GitHub Actions builds the debug APK
                </li>
                <li data-i18n="settings.step5">
                  Download the artifact from the workflow run
                </li>
              </ol>
            </div>
          </div>

          <div class="section-card danger-section">
            <div class="section-title">
              <i class="fa-solid fa-triangle-exclamation"></i>
              <span data-i18n="settings.danger_title">Danger Zone</span>
            </div>
            <p class="section-desc" data-i18n="settings.danger_desc">
              Irreversible actions. Proceed with caution.
            </p>
            <div class="danger-actions">
              <button class="btn btn-outline btn-sm" id="btnClearData">
                <i class="fa-solid fa-eraser"></i> Clear Saved Data
              </button>
              <button class="btn btn-danger btn-sm" id="btnResetForm">
                <i class="fa-solid fa-rotate-left"></i> Reset Form
              </button>
            </div>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer>
        <p data-i18n="footer.copyright">
          &copy; 2026 APK Builder. All rights reserved.
        </p>
        <div style="margin-top: 8px">
          <a
            href="privacy.html"
            target="_blank"
            data-i18n="footer.privacy"
            data-i18n-href="privacy.html"
            >Privacy Policy</a
          >
          <a
            href="terms.html"
            target="_blank"
            data-i18n="footer.terms"
            data-i18n-href="terms.html"
            >Terms & Conditions</a
          >
        </div>
      </footer>
    </div>

    <!-- Snackbar Container -->
    <div class="snackbar-container" id="snackbarContainer"></div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal-box">
        <h3 id="modalTitle">Confirm Action</h3>
        <p id="modalMessage">Are you sure you want to proceed?</p>
        <div class="modal-actions">
          <button class="btn btn-ghost" id="modalCancel">Cancel</button>
          <button class="btn btn-danger" id="modalConfirm">Confirm</button>
        </div>
      </div>
    </div>

    <script>
    // disable klik kanan
    document.addEventListener("contextmenu", function (e) {
      e.preventDefault();
    });

    // disable shortcut keyboard
    document.addEventListener("keydown", function (e) {
      const key = e.key.toLowerCase();

      if (
        key === "f12" ||
        (e.ctrlKey && e.shiftKey && ["i", "j", "c"].includes(key)) ||
        (e.ctrlKey && ["u", "s", "p"].includes(key))
      ) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    });

    // deteksi devtools terbuka (metode sederhana)
    setInterval(function () {
      const threshold = 160;

      if (
        window.outerWidth - window.innerWidth > threshold ||
        window.outerHeight - window.innerHeight > threshold
      ) {
        document.body.innerHTML =
          "<h2 style='font-family:sans-serif;text-align:center;margin-top:20%;'>Inspection tidak diizinkan</h2>";
      }
    }, 1000);
      /* ========================================
       APK Builder - HTML to APK Builder
       ======================================== */

      (function () {
        "use strict";

        // ===== DARK MODE DETECTION =====
        if (
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
        ) {
          document.documentElement.classList.add("dark");
        }
        window
          .matchMedia("(prefers-color-scheme: dark)")
          .addEventListener("change", function (event) {
            if (event.matches) {
              document.documentElement.classList.add("dark");
            } else {
              document.documentElement.classList.remove("dark");
            }
          });

        // ===== STORAGE MODULE =====
        var Storage = (function () {
          var memStore = {};

          function _tryLocal(method, key, value) {
            if (method === "get") return memStore[key] || null;
            if (method === "set") memStore[key] = value;
            if (method === "remove") delete memStore[key];
            if (method === "clear") memStore = {};
          }

          return {
            get: function (k) {
              return _tryLocal("get", k);
            },
            set: function (k, v) {
              _tryLocal("set", k, String(v));
            },
            remove: function (k) {
              _tryLocal("remove", k);
            },
            clear: function () {
              _tryLocal("clear");
            },
            getJSON: function (k) {
              var raw = _tryLocal("get", k);
              if (!raw) return null;
              try {
                return JSON.parse(raw);
              } catch (_e) {
                return null;
              }
            },
            setJSON: function (k, v) {
              _tryLocal("set", k, JSON.stringify(v));
            },
          };
        })();

        // ===== UI MODULE =====
        var UI = (function () {
          var snackbarContainer = document.getElementById("snackbarContainer");

          function showSnackbar(message, type) {
            type = type || "info";
            var icons = {
              success: "fa-circle-check",
              error: "fa-circle-xmark",
              warning: "fa-triangle-exclamation",
              info: "fa-circle-info",
            };
            var el = document.createElement("div");
            el.className = "snackbar " + type;
            el.innerHTML =
              '<i class="fa-solid ' +
              (icons[type] || icons.info) +
              '"></i><span class="msg">' +
              _escapeHtml(message) +
              "</span>";
            snackbarContainer.appendChild(el);
            setTimeout(function () {
              el.classList.add("hide");
              setTimeout(function () {
                if (el.parentNode) el.parentNode.removeChild(el);
              }, 300);
            }, 3500);
          }

          var modalOverlay = document.getElementById("modalOverlay");
          var modalTitle = document.getElementById("modalTitle");
          var modalMessage = document.getElementById("modalMessage");
          var modalConfirmBtn = document.getElementById("modalConfirm");
          var modalCancelBtn = document.getElementById("modalCancel");
          var _modalResolve = null;

          function showConfirm(title, message, confirmText) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalConfirmBtn.textContent = confirmText || "Confirm";
            modalOverlay.classList.add("open");
            return new Promise(function (resolve) {
              _modalResolve = resolve;
            });
          }

          modalConfirmBtn.addEventListener("click", function () {
            modalOverlay.classList.remove("open");
            if (_modalResolve) {
              _modalResolve(true);
              _modalResolve = null;
            }
          });
          modalCancelBtn.addEventListener("click", function () {
            modalOverlay.classList.remove("open");
            if (_modalResolve) {
              _modalResolve(false);
              _modalResolve = null;
            }
          });
          modalOverlay.addEventListener("click", function (e) {
            if (e.target === modalOverlay) {
              modalOverlay.classList.remove("open");
              if (_modalResolve) {
                _modalResolve(false);
                _modalResolve = null;
              }
            }
          });

          function _escapeHtml(text) {
            var div = document.createElement("div");
            div.appendChild(document.createTextNode(text));
            return div.innerHTML;
          }

          return {
            showSnackbar: showSnackbar,
            showConfirm: showConfirm,
            escapeHtml: _escapeHtml,
          };
        })();

        // ===== TAB NAVIGATION =====
        var tabBtns = document.querySelectorAll(".tab-btn");
        var tabPanels = document.querySelectorAll(".tab-panel");

        tabBtns.forEach(function (btn) {
          btn.addEventListener("click", function () {
            var tab = btn.getAttribute("data-tab");
            tabBtns.forEach(function (b) {
              b.classList.remove("active");
              b.setAttribute("aria-selected", "false");
            });
            tabPanels.forEach(function (p) {
              p.classList.remove("active");
            });
            btn.classList.add("active");
            btn.setAttribute("aria-selected", "true");
            var panel = document.getElementById("panel-" + tab);
            if (panel) panel.classList.add("active");
            if (tab === "preview" && appState.htmlContent) {
              refreshPreview();
            }
          });
        });

        // ===== APP STATE =====
        var appState = {
          htmlFile: null,
          htmlContent: null,
          htmlFileName: null,
          iconFile: null,
          iconDataUrl: null,
          settings: {
            autoSave: true,
            autoRefresh: true,
          },
          building: false,
        };

        // ===== FORM FIELDS =====
        var fields = {
          apkName: document.getElementById("apkName"),
          packageName: document.getElementById("packageName"),
          versionName: document.getElementById("versionName"),
          versionCode: document.getElementById("versionCode"),
          ghUsername: document.getElementById("ghUsername"),
          ghToken: document.getElementById("ghToken"),
          repoName: document.getElementById("repoName"),
          repoVisibility: document.getElementById("repoVisibility"),
        };

        // ===== AUTO-SAVE =====
        function saveFormData() {
          if (!appState.settings.autoSave) return;
          var data = {};
          Object.keys(fields).forEach(function (key) {
            if (key !== "ghToken") data[key] = fields[key].value;
          });
          Storage.setJSON("apkforge_form", data);
        }

        function loadFormData() {
          var data = Storage.getJSON("apkforge_form");
          if (!data) return;
          Object.keys(data).forEach(function (key) {
            if (fields[key] && key !== "ghToken") {
              fields[key].value = data[key];
            }
          });
        }

        function loadSettings() {
          var s = Storage.getJSON("apkforge_settings");
          if (s) {
            appState.settings.autoSave = s.autoSave !== false;
            appState.settings.autoRefresh = s.autoRefresh !== false;
          }
          updateToggle("toggleAutosave", appState.settings.autoSave);
          updateToggle("toggleAutorefresh", appState.settings.autoRefresh);
        }

        function saveSettings() {
          Storage.setJSON("apkforge_settings", appState.settings);
        }

        function updateToggle(id, on) {
          var el = document.getElementById(id);
          if (!el) return;
          if (on) {
            el.classList.add("on");
            el.setAttribute("aria-checked", "true");
          } else {
            el.classList.remove("on");
            el.setAttribute("aria-checked", "false");
          }
        }

        // Debounced auto-save
        var _saveTimer = null;
        Object.keys(fields).forEach(function (key) {
          fields[key].addEventListener("input", function () {
            clearTimeout(_saveTimer);
            _saveTimer = setTimeout(saveFormData, 500);
          });
        });

        // ===== TOKEN TOGGLE =====
        var tokenToggle = document.getElementById("tokenToggle");
        tokenToggle.addEventListener("click", function () {
          var input = fields.ghToken;
          var icon = tokenToggle.querySelector("i");
          if (input.type === "password") {
            input.type = "text";
            icon.className = "fa-solid fa-eye-slash";
          } else {
            input.type = "password";
            icon.className = "fa-solid fa-eye";
          }
        });

        // ===== ICON UPLOAD =====
        var iconUploadZone = document.getElementById("iconUploadZone");
        var iconFileInput = document.getElementById("iconFileInput");
        var iconPreview = document.getElementById("iconPreview");

        iconUploadZone.addEventListener("click", function () {
          iconFileInput.click();
        });
        iconUploadZone.addEventListener("dragover", function (e) {
          e.preventDefault();
          iconUploadZone.classList.add("dragover");
        });
        iconUploadZone.addEventListener("dragleave", function () {
          iconUploadZone.classList.remove("dragover");
        });
        iconUploadZone.addEventListener("drop", function (e) {
          e.preventDefault();
          iconUploadZone.classList.remove("dragover");
          if (e.dataTransfer.files.length > 0)
            handleIconFile(e.dataTransfer.files[0]);
        });
        iconFileInput.addEventListener("change", function () {
          if (iconFileInput.files.length > 0)
            handleIconFile(iconFileInput.files[0]);
        });

        function handleIconFile(file) {
          if (!file.type.startsWith("image/")) {
            UI.showSnackbar("Please select an image file", "error");
            return;
          }
          appState.iconFile = file;
          var reader = new FileReader();
          reader.onload = function (e) {
            appState.iconDataUrl = e.target.result;
            iconPreview.innerHTML =
              '<img src="' + e.target.result + '" alt="App Icon">';
            iconUploadZone.classList.add("has-icon");
            iconUploadZone.querySelector(".title").textContent = file.name;
            iconUploadZone.querySelector(".hint").textContent = _formatBytes(
              file.size,
            );
          };
          reader.readAsDataURL(file);
        }

        // ===== HTML FILE UPLOAD =====
        var htmlUploadZone = document.getElementById("htmlUploadZone");
        var htmlFileInput = document.getElementById("htmlFileInput");
        var htmlFileInfo = document.getElementById("htmlFileInfo");
        var htmlFileName = document.getElementById("htmlFileName");
        var htmlFileSize = document.getElementById("htmlFileSize");
        var htmlRemoveBtn = document.getElementById("htmlRemoveBtn");

        htmlUploadZone.addEventListener("click", function (e) {
          if (e.target.closest(".upload-remove")) return;
          htmlFileInput.click();
        });
        htmlUploadZone.addEventListener("dragover", function (e) {
          e.preventDefault();
          htmlUploadZone.classList.add("dragover");
        });
        htmlUploadZone.addEventListener("dragleave", function () {
          htmlUploadZone.classList.remove("dragover");
        });
        htmlUploadZone.addEventListener("drop", function (e) {
          e.preventDefault();
          htmlUploadZone.classList.remove("dragover");
          if (e.dataTransfer.files.length > 0)
            handleHtmlFile(e.dataTransfer.files[0]);
        });
        htmlFileInput.addEventListener("change", function () {
          if (htmlFileInput.files.length > 0)
            handleHtmlFile(htmlFileInput.files[0]);
        });
        htmlRemoveBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          clearHtmlFile();
        });

        function handleHtmlFile(file) {
          var ext = file.name.split(".").pop().toLowerCase();
          if (ext !== "html" && ext !== "htm") {
            UI.showSnackbar("Only .html files are accepted", "error");
            return;
          }
          appState.htmlFile = file;
          appState.htmlFileName = file.name;
          var reader = new FileReader();
          reader.onload = function (e) {
            appState.htmlContent = e.target.result;
            htmlFileName.textContent = file.name;
            htmlFileSize.textContent = _formatBytes(file.size);
            htmlFileInfo.style.display = "flex";
            htmlUploadZone.classList.add("has-file");
            UI.showSnackbar("HTML file loaded successfully", "success");
            if (appState.settings.autoRefresh) refreshPreview();
          };
          reader.readAsText(file);
        }

        function clearHtmlFile() {
          appState.htmlFile = null;
          appState.htmlContent = null;
          appState.htmlFileName = null;
          htmlFileInfo.style.display = "none";
          htmlUploadZone.classList.remove("has-file");
          htmlFileInput.value = "";
          var frame = document.getElementById("previewFrame");
          frame.style.display = "none";
          document.getElementById("previewEmpty").style.display = "flex";
          document.getElementById("previewUrl").textContent = "No file loaded";
        }

        // ===== PREVIEW =====
        function refreshPreview() {
          var frame = document.getElementById("previewFrame");
          var empty = document.getElementById("previewEmpty");
          var urlBar = document.getElementById("previewUrl");
          if (!appState.htmlContent) {
            frame.style.display = "none";
            empty.style.display = "flex";
            urlBar.textContent = "No file loaded";
            return;
          }
          empty.style.display = "none";
          frame.style.display = "block";
          urlBar.textContent = appState.htmlFileName || "preview.html";
          var blob = new Blob([appState.htmlContent], { type: "text/html" });
          var url = URL.createObjectURL(blob);
          frame.src = url;
        }

        document
          .getElementById("previewReload")
          .addEventListener("click", function () {
            refreshPreview();
            UI.showSnackbar("Preview reloaded", "info");
          });

        // ===== SETTINGS TOGGLES =====
        document
          .getElementById("toggleAutosave")
          .addEventListener("click", function () {
            appState.settings.autoSave = !appState.settings.autoSave;
            updateToggle("toggleAutosave", appState.settings.autoSave);
            saveSettings();
            UI.showSnackbar(
              "Auto-save " +
                (appState.settings.autoSave ? "enabled" : "disabled"),
              "info",
            );
          });

        document
          .getElementById("toggleAutorefresh")
          .addEventListener("click", function () {
            appState.settings.autoRefresh = !appState.settings.autoRefresh;
            updateToggle("toggleAutorefresh", appState.settings.autoRefresh);
            saveSettings();
            UI.showSnackbar(
              "Auto-refresh " +
                (appState.settings.autoRefresh ? "enabled" : "disabled"),
              "info",
            );
          });

        // ===== DANGER ZONE =====
        document
          .getElementById("btnClearData")
          .addEventListener("click", async function () {
            var yes = await UI.showConfirm(
              "Clear Saved Data",
              "This will remove all saved form data and preferences. Your current session data will remain.",
              "Clear Data",
            );
            if (yes) {
              Storage.clear();
              UI.showSnackbar("Saved data cleared", "success");
            }
          });

        document
          .getElementById("btnResetForm")
          .addEventListener("click", async function () {
            var yes = await UI.showConfirm(
              "Reset Form",
              "This will clear all form fields, uploaded files, and reset to defaults. This cannot be undone.",
              "Reset",
            );
            if (yes) {
              Object.keys(fields).forEach(function (key) {
                if (key === "versionName") fields[key].value = "1.0.0";
                else if (key === "versionCode") fields[key].value = "1";
                else if (key === "repoVisibility") fields[key].value = "public";
                else fields[key].value = "";
              });
              clearHtmlFile();
              appState.iconFile = null;
              appState.iconDataUrl = null;
              iconPreview.innerHTML = '<i class="fa-solid fa-image"></i>';
              iconUploadZone.classList.remove("has-icon");
              iconUploadZone.querySelector(".title").textContent =
                "Upload Icon";
              iconUploadZone.querySelector(".hint").textContent =
                "PNG recommended, 512×512px";
              Storage.clear();
              UI.showSnackbar("Form has been reset", "success");
            }
          });

        document
          .getElementById("clearLogsBtn")
          .addEventListener("click", function () {
            document.getElementById("logsBody").innerHTML = "";
          });

        // ===== GITHUB MODULE =====
        // ===== GITHUB MODULE =====
        var GitHub = (function () {
          var API_BASE = "https://api.github.com";

          function _headers(token) {
            return {
              Authorization: "Bearer " + token,
              Accept: "application/vnd.github+json",
              "X-GitHub-Api-Version": "2022-11-28",
              "Content-Type": "application/json",
            };
          }

          async function createRepo(username, token, repoName, isPrivate) {
            var res = await fetch(API_BASE + "/user/repos", {
              method: "POST",
              headers: _headers(token),
              body: JSON.stringify({
                name: repoName,
                private: isPrivate,
                auto_init: false,
                description: "Android APK built with APK Builder",
              }),
            });

            if (!res.ok) {
              var err = await res.json().catch(function () {
                return {};
              });
              throw new Error(
                err.message ||
                  "Failed to create repository (HTTP " + res.status + ")",
              );
            }

            return res.json();
          }

          // FIXED uploadFile (support binary)
          async function uploadFile(
            username,
            token,
            repo,
            path,
            content,
            message,
            isBinary,
          ) {
            var base64Content;

            if (isBinary) {
              // content sudah base64 dari FileReader
              base64Content = content;
            } else {
              // encode teks biasa
              base64Content = btoa(unescape(encodeURIComponent(content)));
            }

            var res = await fetch(
              API_BASE +
                "/repos/" +
                username +
                "/" +
                repo +
                "/contents/" +
                path,
              {
                method: "PUT",
                headers: _headers(token),
                body: JSON.stringify({
                  message: message || "Add " + path,
                  content: base64Content,
                }),
              },
            );

            if (!res.ok) {
              var err = await res.json().catch(function () {
                return {};
              });
              throw new Error(
                err.message ||
                  "Failed to upload " + path + " (HTTP " + res.status + ")",
              );
            }

            return res.json();
          }

          async function getWorkflowRuns(username, token, repo) {
            var res = await fetch(
              API_BASE +
                "/repos/" +
                username +
                "/" +
                repo +
                "/actions/runs?per_page=1",
              {
                headers: _headers(token),
              },
            );
            if (!res.ok) throw new Error("Failed to fetch workflow runs");
            return res.json();
          }

          async function getWorkflowRun(username, token, repo, runId) {
            var res = await fetch(
              API_BASE +
                "/repos/" +
                username +
                "/" +
                repo +
                "/actions/runs/" +
                runId,
              {
                headers: _headers(token),
              },
            );
            if (!res.ok) throw new Error("Failed to fetch workflow run status");
            return res.json();
          }

          async function getArtifacts(username, token, repo, runId) {
            var res = await fetch(
              API_BASE +
                "/repos/" +
                username +
                "/" +
                repo +
                "/actions/runs/" +
                runId +
                "/artifacts",
              {
                headers: _headers(token),
              },
            );
            if (!res.ok) throw new Error("Failed to fetch artifacts");
            return res.json();
          }

          return {
            createRepo: createRepo,
            uploadFile: uploadFile,
            getWorkflowRuns: getWorkflowRuns,
            getWorkflowRun: getWorkflowRun,
            getArtifacts: getArtifacts,
          };
        })();

        // ===== BUILD MODULE =====
        var buildStepper = document.getElementById("buildStepper");
        var buildLogs = document.getElementById("buildLogs");
        var logsBody = document.getElementById("logsBody");
        var downloadCard = document.getElementById("downloadCard");
        var buildHero = document.getElementById("buildHero");
        var buildStartBtn = document.getElementById("buildStartBtn");

        function addLog(msg, type) {
          type = type || "";
          var now = new Date();
          var time =
            String(now.getHours()).padStart(2, "0") +
            ":" +
            String(now.getMinutes()).padStart(2, "0") +
            ":" +
            String(now.getSeconds()).padStart(2, "0");
          var line = document.createElement("div");
          line.className = "log-line" + (type ? " " + type : "");
          line.innerHTML =
            '<span class="log-time">' +
            time +
            '</span><span class="log-msg">' +
            UI.escapeHtml(msg) +
            "</span>";
          logsBody.appendChild(line);
          logsBody.scrollTop = logsBody.scrollHeight;
        }

        function setStep(index, state) {
          var items = buildStepper.querySelectorAll(".step-item");
          items.forEach(function (item, i) {
            item.classList.remove("active", "completed", "error");
            var dot = item.querySelector(".step-dot");
            if (i < index) {
              item.classList.add("completed");
              dot.innerHTML =
                '<i class="fa-solid fa-check" style="font-size:12px"></i>';
            } else if (i === index) {
              item.classList.add(state || "active");
              if (state === "error") {
                dot.innerHTML =
                  '<i class="fa-solid fa-xmark" style="font-size:12px"></i>';
              } else if (state === "completed") {
                dot.innerHTML =
                  '<i class="fa-solid fa-check" style="font-size:12px"></i>';
              } else {
                dot.textContent = String(i + 1);
              }
            } else {
              dot.textContent = String(i + 1);
            }
          });
        }

        function validateForm() {
          var errors = [];
          if (!fields.apkName.value.trim()) errors.push("APK Name is required");
          if (!fields.packageName.value.trim())
            errors.push("Package Name is required");
          if (!fields.ghUsername.value.trim())
            errors.push("GitHub Username is required");
          if (!fields.ghToken.value.trim())
            errors.push("Personal Access Token is required");
          if (!fields.repoName.value.trim())
            errors.push("Repository Name is required");
          if (!appState.htmlContent) errors.push("HTML file is required");

          var pkg = fields.packageName.value.trim();
          if (pkg && !/^[a-z][a-z0-9]*(\.[a-z][a-z0-9]*)+$/.test(pkg)) {
            errors.push("Invalid package name format (use com.example.app)");
          }
          return errors;
        }

        function generateConfigXml() {
          var name = fields.apkName.value.trim();
          var pkg = fields.packageName.value.trim();
          var ver = fields.versionName.value.trim() || "1.0.0";
          var code = fields.versionCode.value.trim() || "1";

          var iconBlock = "";
          if (appState.iconDataUrl) {
            iconBlock =
              '    <icon density="ldpi" src="res/icon.png" />\n' +
              '    <icon density="mdpi" src="res/icon.png" />\n' +
              '    <icon density="hdpi" src="res/icon.png" />\n' +
              '    <icon density="xhdpi" src="res/icon.png" />\n' +
              '    <icon density="xxhdpi" src="res/icon.png" />\n' +
              '    <icon density="xxxhdpi" src="res/icon.png" />\n';
          }

          return (
            '<?xml version="1.0" encoding="UTF-8"?>\n' +
            '<widget id="' +
            pkg +
            '" version="' +
            ver +
            '" android-versionCode="' +
            code +
            '" ' +
            'xmlns="http://www.w3.org/ns/widgets" ' +
            'xmlns:cdv="http://cordova.apache.org/ns/1.0">\n' +
            "  <name>" +
            name +
            "</name>\n" +
            "  <description>Built with APK Builder</description>\n" +
            "  <author>APK Builder User</author>\n" +
            '  <content src="index.html" />\n' +
            '  <access origin="*" />\n' +
            '  <allow-intent href="http://*/*" />\n' +
            '  <allow-intent href="https://*/*" />\n' +
            '  <preference name="DisallowOverscroll" value="true" />\n' +
            '  <preference name="android-minSdkVersion" value="24" />\n' +
            '  <preference name="android-targetSdkVersion" value="34" />\n' +
            '  <preference name="Fullscreen" value="false" />\n' +
            '  <preference name="Orientation" value="default" />\n' +
            '  <platform name="android">\n' +
            '    <allow-intent href="market:*" />\n' +
            iconBlock +
            "  </platform>\n" +
            "</widget>"
          );
        }

        function generatePackageJson() {
          var name = fields.repoName.value
            .trim()
            .toLowerCase()
            .replace(/[^a-z0-9-]/g, "-");
          return JSON.stringify(
            {
              name: name,
              displayName: fields.apkName.value.trim(),
              version: fields.versionName.value.trim() || "1.0.0",
              description: "Built with APK Builder",
              main: "index.js",
              scripts: { test: 'echo "test"' },
              keywords: ["cordova", "android"],
              author: "APK Builder",
              license: "MIT",
              devDependencies: {},
              cordova: {
                platforms: [],
                plugins: {},
              },
            },
            null,
            2,
          );
        }

        var WORKFLOW_YML = `name: Build HTML to APK (Cordova Debug)

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install Cordova
        run: npm install -g cordova

      - name: Install dependencies
        run: npm install || true

      - name: Add Android platform
        run: cordova platform add android

      - name: Prepare project
        run: cordova prepare android

      - name: Build Debug APK
        run: cordova build android

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: app-debug-apk
          path: platforms/android/app/build/outputs/apk/debug/app-debug.apk
`;

        async function fileToBase64(file) {
          return new Promise(function (resolve, reject) {
            var reader = new FileReader();
            reader.onload = function () {
              var result = reader.result;
              resolve(result.split(",")[1]);
            };
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        }

        async function startBuild() {
          if (appState.building) return;

          var errors = validateForm();
          if (errors.length > 0) {
            errors.forEach(function (e) {
              UI.showSnackbar(e, "error");
            });
            return;
          }

          appState.building = true;
          buildStartBtn.classList.add("loading");
          buildStartBtn.disabled = true;
          buildStepper.classList.add("visible");
          buildLogs.classList.add("visible");
          downloadCard.classList.remove("visible");
          logsBody.innerHTML = "";

          var username = fields.ghUsername.value.trim();
          var token = fields.ghToken.value.trim();
          var repo = fields.repoName.value.trim();
          var isPrivate = fields.repoVisibility.value === "private";

          try {
            // Step 0: Create repository
            setStep(0, "active");
            addLog("Creating GitHub repository: " + repo + "...", "info");
            await GitHub.createRepo(username, token, repo, isPrivate);
            addLog("Repository created successfully", "success");
            setStep(0, "completed");

            // Small delay to let GitHub initialize
            await _sleep(1500);

            // Step 1: Upload files
            setStep(1, "active");

            // Upload HTML
            addLog("Uploading www/index.html...");
            await GitHub.uploadFile(
              username,
              token,
              repo,
              "www/index.html",
              appState.htmlContent,
              "Add HTML source",
            );
            addLog("HTML file uploaded", "success");

            // Upload config.xml
            addLog("Uploading config.xml...");
            await GitHub.uploadFile(
              username,
              token,
              repo,
              "config.xml",
              generateConfigXml(),
              "Add Cordova config",
            );
            addLog("Config uploaded", "success");

            // Upload package.json
            addLog("Uploading package.json...");
            await GitHub.uploadFile(
              username,
              token,
              repo,
              "package.json",
              generatePackageJson(),
              "Add package.json",
            );
            addLog("Package.json uploaded", "success");

            // Upload icon if exists
            if (appState.iconFile) {
              addLog("Uploading app icon...");
              var iconBase64 = await fileToBase64(appState.iconFile);
              await GitHub.uploadFile(
                username,
                token,
                repo,
                "res/icon.png",
                iconBase64,
                "Add app icon",
                true,
              );
              addLog("Icon uploaded", "success");
            }

            // Upload workflow (this triggers GitHub Actions)
            addLog("Uploading GitHub Actions workflow...");
            await GitHub.uploadFile(
              username,
              token,
              repo,
              ".github/workflows/build.yml",
              WORKFLOW_YML,
              "Add build workflow",
            );
            addLog(
              "Workflow uploaded — build will trigger automatically",
              "success",
            );

            setStep(1, "completed");

            // Step 2: Trigger / Wait for Actions
            setStep(2, "active");
            addLog("Waiting for GitHub Actions to start...", "info");
            await _sleep(5000);

            var runId = null;
            var maxAttempts = 20;
            for (var a = 0; a < maxAttempts; a++) {
              var runsData = await GitHub.getWorkflowRuns(
                username,
                token,
                repo,
              );
              if (runsData.workflow_runs && runsData.workflow_runs.length > 0) {
                runId = runsData.workflow_runs[0].id;
                addLog("Workflow run detected: #" + runId, "success");
                break;
              }
              addLog(
                "Waiting for workflow to start... (attempt " + (a + 1) + ")",
              );
              await _sleep(5000);
            }

            if (!runId) {
              throw new Error(
                "GitHub Actions workflow did not start after multiple attempts. Check your repository settings.",
              );
            }

            setStep(2, "completed");

            // Step 3: Monitor build
            setStep(3, "active");
            addLog("Monitoring build progress...", "info");

            var completed = false;
            var pollCount = 0;
            var maxPolls = 120; // ~10 minutes
            while (!completed && pollCount < maxPolls) {
              pollCount++;
              await _sleep(5000);
              var run = await GitHub.getWorkflowRun(
                username,
                token,
                repo,
                runId,
              );
              var status = run.status;
              var conclusion = run.conclusion;

              if (pollCount % 6 === 0) {
                addLog(
                  "Build in progress... (" +
                    Math.floor((pollCount * 5) / 60) +
                    "m " +
                    ((pollCount * 5) % 60) +
                    "s elapsed)",
                );
              }

              if (status === "completed") {
                completed = true;
                if (conclusion === "success") {
                  addLog("Build completed successfully!", "success");
                  setStep(3, "completed");

                  // Step 4: Get artifact
                  setStep(4, "active");
                  addLog("Fetching build artifact...", "info");
                  await _sleep(2000);
                  var artifacts = await GitHub.getArtifacts(
                    username,
                    token,
                    repo,
                    runId,
                  );
                  if (artifacts.artifacts && artifacts.artifacts.length > 0) {
                    var artifact = artifacts.artifacts[0];
                    addLog(
                      "Artifact found: " +
                        artifact.name +
                        " (" +
                        _formatBytes(artifact.size_in_bytes) +
                        ")",
                      "success",
                    );
                    var artifactUrl =
                      "https://github.com/" +
                      username +
                      "/" +
                      repo +
                      "/actions/runs/" +
                      runId;
                    
                    var downloadLinkEl =
                      document.getElementById("downloadLink");
                    // set link utama
                    downloadLinkEl.href = artifactUrl;
                    
                    downloadCard.classList.add("visible");
                    setStep(4, "completed");
                    addLog(
                      "Build process complete! Your APK is ready.",
                      "success",
                    );
                    UI.showSnackbar("APK build successful!", "success");
                  } else {
                    addLog(
                      "No artifacts found. The build may have completed without producing an APK.",
                      "error",
                    );
                    var fallbackUrl =
                      "https://github.com/" +
                      username +
                      "/" +
                      repo +
                      "/actions/runs/" +
                      runId;
                    document.getElementById("downloadLink").href = fallbackUrl;
                    downloadCard.classList.add("visible");
                    setStep(4, "completed");
                  }
                } else {
                  addLog(
                    "Build failed with conclusion: " + conclusion,
                    "error",
                  );
                  setStep(3, "error");
                  UI.showSnackbar("Build failed: " + conclusion, "error");
                  var failUrl =
                    "https://github.com/" +
                    username +
                    "/" +
                    repo +
                    "/actions/runs/" +
                    runId;
                  addLog("View details: " + failUrl, "info");
                }
              }
            }

            if (!completed) {
              addLog(
                "Build monitoring timed out. Check GitHub Actions for status.",
                "warning",
              );
              setStep(3, "error");
              var timeoutUrl =
                "https://github.com/" + username + "/" + repo + "/actions";
              addLog("View at: " + timeoutUrl, "info");
              UI.showSnackbar("Build monitoring timed out", "warning");
            }
          } catch (err) {
            addLog("Error: " + err.message, "error");
            UI.showSnackbar(err.message, "error");
            // Mark current active step as error
            var activeStep = buildStepper.querySelector(".step-item.active");
            if (activeStep) {
              var idx = parseInt(activeStep.getAttribute("data-step"), 10);
              setStep(idx, "error");
            }
          } finally {
            appState.building = false;
            buildStartBtn.classList.remove("loading");
            buildStartBtn.disabled = false;
          }
        }

        buildStartBtn.addEventListener("click", startBuild);

        // ===== UTILITIES =====
        function _formatBytes(bytes) {
          if (bytes === 0) return "0 B";
          var k = 1024;
          var sizes = ["B", "KB", "MB", "GB"];
          var i = Math.floor(Math.log(bytes) / Math.log(k));
          return (
            parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + " " + sizes[i]
          );
        }

        function _sleep(ms) {
          return new Promise(function (resolve) {
            setTimeout(resolve, ms);
          });
        }

        // ===== INIT =====
        loadSettings();
        loadFormData();
      })();
    </script>
    <script src="js/lang.js"></script>
  </body>
</html>
